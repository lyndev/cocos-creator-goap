{"version":3,"sources":["assets/src/app/gamedata/actions/ForgeToolAction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,oDAA+C;AAC/C,2DAA0D;AAC1D,uDAAsD;AAGtD,8CAA6C;AAI7C;;;;;;GAMG;AACH;IAAqC,mCAAU;IAM9C;QAAA,YACC,iBAAO,SAGP;QATO,YAAM,GAAY,KAAK,CAAC;QAGxB,eAAS,GAAW,CAAC,CAAC;QACtB,mBAAa,GAAW,CAAC,CAAC,CAAC,UAAU;QAG5C,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAChD,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;;IAChD,CAAC;IAEM,+BAAK,GAAZ;QACC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;IACpB,CAAC;IAEM,gCAAM,GAAb;QACC,OAAO,IAAI,CAAC,MAAM,CAAC;IACpB,CAAC;IACM,yCAAe,GAAtB;QACC,OAAO,IAAI,CAAC;IACb,CAAC;IAEM,qDAA2B,GAAlC,UAAmC,KAAkB;QACpD,8BAA8B;QAC9B,IAAI,MAAM,GAAqB,yBAAW,CAAC,UAAU,CAAC;QACtD,IAAI,OAAO,GAAmB,IAAI,CAAC;QACnC,IAAI,WAAW,GAAW,CAAC,CAAC;QAE5B,KAAkB,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAM,EAAE;YAArB,IAAI,KAAK,eAAA;YACb,IAAI,OAAO,IAAI,IAAI,EAAE;gBACpB,kCAAkC;gBAClC,OAAO,GAAG,KAAK,CAAC;gBAChB,WAAW,GAAG,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;aAC1C;iBAAM;gBACN,oCAAoC;gBACpC,IAAI,IAAI,GAAW,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;gBAC/C,IAAI,IAAI,GAAG,WAAW,EAAE;oBACvB,gCAAgC;oBAChC,OAAO,GAAG,KAAK,CAAC;oBAChB,WAAW,GAAG,IAAI,CAAC;iBACnB;aACD;SACD;QACD,IAAI,OAAO,IAAI,IAAI;YAClB,OAAO,KAAK,CAAC;QAEd,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;QAEtB,OAAO,OAAO,IAAI,IAAI,CAAC;IACxB,CAAC;IAEM,iCAAO,GAAd,UAAe,QAAkB;QAChC,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC;YACtB,IAAI,CAAC,SAAS,GAAG,kBAAQ,CAAC,OAAO,EAAE,CAAC;QAErC,IAAI,kBAAQ,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,aAAa,EAAE;YAC7D,0BAA0B;YAC1B,IAAI,QAAQ,GAAsB,QAAQ,CAAC,QAAQ,CAAC;YACpD,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;YACpB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;SACnB;QACD,OAAO,IAAI,CAAC;IACb,CAAC;IACF,sBAAC;AAAD,CAjEA,AAiEC,CAjEoC,uBAAU,GAiE9C;AAjEY,0CAAe","file":"","sourceRoot":"/","sourcesContent":["import TimeUtil from \"../../../utils/TimeUtil\";\nimport { ActionStatus } from \"../../ai/goap/ActionStatus\";\nimport { GoapAction } from \"../../ai/goap/GoapAction\";\nimport { VGameObject } from \"../../base/VGameObject\";\nimport { BackPackComponent } from \"../BackPackComponent\";\nimport { Environment } from \"../Environment\";\nimport { ForgeComponent } from \"../ForgeComponent\";\nimport { Labourer } from \"../labourers/Labourer\";\n\n/*\n * @Description: \n * @Author: RannarYang \n * @Date: 2018-09-06 00:12:33 \n * @Last Modified by: RannarYang\n * @Last Modified time: 2018-10-28 11:36:06\n */\nexport class ForgeToolAction extends GoapAction {\n\tprivate forged: boolean = false;\n\tpublic target: ForgeComponent; // where we forge tools\n\n\tprivate startTime: number = 0;\n\tprivate forgeDuration: number = 2; // seconds\n\tpublic constructor() {\n\t\tsuper();\n\t\tthis.addPrecondition(ActionStatus.HasOre, true);\n\t\tthis.addEffect(ActionStatus.HasNewTools, true);\n\t}\n\n\tpublic reset() {\n\t\tthis.forged = false;\n\t\tthis.startTime = 0;\n\t}\n\n\tpublic isDone(): boolean {\n\t\treturn this.forged;\n\t}\n\tpublic requiresInRange(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic checkProceduralPrecondition(agent: VGameObject): boolean {\n\t\t//TODO: find the nearest forge\n\t\tlet forges: ForgeComponent[] = Environment.forgeComps;\n\t\tlet closest: ForgeComponent = null;\n\t\tlet closestDist: number = 0;\n\n\t\tfor (let forge of forges) {\n\t\t\tif (closest == null) {\n\t\t\t\t// first one, so choose it for now\n\t\t\t\tclosest = forge;\n\t\t\t\tclosestDist = forge.distanceSquare(agent);\n\t\t\t} else {\n\t\t\t\t// is this one closer than the last?\n\t\t\t\tlet dist: number = forge.distanceSquare(agent);\n\t\t\t\tif (dist < closestDist) {\n\t\t\t\t\t// we found a closer one, use it\n\t\t\t\t\tclosest = forge;\n\t\t\t\t\tclosestDist = dist;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (closest == null)\n\t\t\treturn false;\n\n\t\tthis.target = closest;\n\n\t\treturn closest != null;\n\t}\n\n\tpublic perform(labourer: Labourer): boolean {\n\t\tif (this.startTime == 0)\n\t\t\tthis.startTime = TimeUtil.getTime();\n\n\t\tif (TimeUtil.getTime() - this.startTime > this.forgeDuration) {\n\t\t\t// finished forging a tool\n\t\t\tlet backpack: BackPackComponent = labourer.backpack;\n\t\t\tbackpack.numOre = 0;\n\t\t\tthis.forged = true;\n\t\t}\n\t\treturn true;\n\t}\n}"]}
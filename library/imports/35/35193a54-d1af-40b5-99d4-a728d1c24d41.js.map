{"version":3,"sources":["assets\\src\\app\\gamedata\\actions\\PickUpOreAction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,2DAA0D;AAC1D,uDAAsD;AAGtD,8CAA6C;AAI7C;;;;;;GAMG;AACH;IAAqC,mCAAU;IAG9C;QAAA,YACC,iBAAO,SAGP;QANO,YAAM,GAAY,KAAK,CAAC;QAI/B,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,yCAAyC;QAC3F,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC,oBAAoB;;IAChE,CAAC;IAEM,+BAAK,GAAZ;QACC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACrB,CAAC;IAEM,gCAAM,GAAb;QACC,OAAO,IAAI,CAAC,MAAM,CAAC;IACpB,CAAC;IAEM,yCAAe,GAAtB;QACC,OAAO,IAAI,CAAC,CAAC,iEAAiE;IAC/E,CAAC;IAEM,qDAA2B,GAAlC,UAAmC,KAAkB;QACpD,kDAAkD;QAClD,IAAI,WAAW,GAA0B,yBAAW,CAAC,eAAe,CAAC;QACrE,IAAI,OAAO,GAAwB,IAAI,CAAC;QACxC,IAAI,WAAW,GAAW,CAAC,CAAC;QAE5B,KAAmB,UAAW,EAAX,2BAAW,EAAX,yBAAW,EAAX,IAAW,EAAE;YAA3B,IAAI,MAAM,oBAAA;YACd,IAAI,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,wBAAwB;gBACjD,IAAI,OAAO,IAAI,IAAI,EAAE;oBACpB,kCAAkC;oBAClC,OAAO,GAAG,MAAM,CAAC;oBACjB,WAAW,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;iBAC3C;qBAAM;oBACN,oCAAoC;oBACpC,IAAI,IAAI,GAAW,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;oBAChD,IAAI,IAAI,GAAG,WAAW,EAAE;wBACvB,gCAAgC;wBAChC,OAAO,GAAG,MAAM,CAAC;wBACjB,WAAW,GAAG,IAAI,CAAC;qBACnB;iBACD;aACD;SACD;QACD,IAAI,OAAO,IAAI,IAAI;YAClB,OAAO,KAAK,CAAC;QAEd,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;QAEtB,OAAO,OAAO,IAAI,IAAI,CAAC;IACxB,CAAC;IAEM,iCAAO,GAAd,UAAe,QAAkB;QAChC,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE;YAC5B,IAAI,CAAC,MAAM,CAAC,MAAM,IAAI,CAAC,CAAC;YACxB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,qCAAqC;YACrC,IAAI,QAAQ,GAAsB,QAAQ,CAAC,QAAQ,CAAC;YACpD,QAAQ,CAAC,MAAM,IAAI,CAAC,CAAC;YAErB,OAAO,IAAI,CAAC;SACZ;aAAM;YACN,8FAA8F;YAC9F,OAAO,KAAK,CAAC;SACb;IACF,CAAC;IAGF,sBAAC;AAAD,CApEA,AAoEC,CApEoC,uBAAU,GAoE9C;AApEY,0CAAe","file":"","sourceRoot":"/","sourcesContent":["import { ActionStatus } from \"../../ai/goap/ActionStatus\";\r\nimport { GoapAction } from \"../../ai/goap/GoapAction\";\r\nimport { VGameObject } from \"../../base/VGameObject\";\r\nimport { BackPackComponent } from \"../BackPackComponent\";\r\nimport { Environment } from \"../Environment\";\r\nimport { Labourer } from \"../labourers/Labourer\";\r\nimport { SupplyPileComponent } from \"../SupplyPileComponent\";\r\n\r\n/*\r\n * @Description: \r\n * @Author: RannarYang \r\n * @Date: 2018-09-06 00:14:55 \r\n * @Last Modified by: RannarYang\r\n * @Last Modified time: 2018-10-28 11:37:41\r\n */\r\nexport class PickUpOreAction extends GoapAction {\r\n\tprivate hasOre: boolean = false;\r\n\tpublic target: SupplyPileComponent; // where we get the ore from\r\n\tpublic constructor() {\r\n\t\tsuper();\r\n\t\tthis.addPrecondition(ActionStatus.HasOre, false); // don't get a ore if we already have one\r\n\t\tthis.addEffect(ActionStatus.HasOre, true); // we now have a ore\r\n\t}\r\n\r\n\tpublic reset(): void {\r\n\t\tthis.hasOre = false;\r\n\t}\r\n\r\n\tpublic isDone(): boolean {\r\n\t\treturn this.hasOre;\r\n\t}\r\n\r\n\tpublic requiresInRange(): boolean {\r\n\t\treturn true; // yes we need to be near a supply pile so we can pick up the ore\r\n\t}\r\n\r\n\tpublic checkProceduralPrecondition(agent: VGameObject): boolean {\r\n\t\t//find the nearest supply pile that has spare ores\r\n\t\tlet supplyPiles: SupplyPileComponent[] = Environment.supplyPileComps;\r\n\t\tlet closest: SupplyPileComponent = null;\r\n\t\tlet closestDist: number = 0;\r\n\r\n\t\tfor (let supply of supplyPiles) {\r\n\t\t\tif (supply.numOre >= 3) { // we need to take 3 ore\r\n\t\t\t\tif (closest == null) {\r\n\t\t\t\t\t// first one, so choose it for now\r\n\t\t\t\t\tclosest = supply;\r\n\t\t\t\t\tclosestDist = supply.distanceSquare(agent);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// is this one closer than the last?\r\n\t\t\t\t\tlet dist: number = supply.distanceSquare(agent);\r\n\t\t\t\t\tif (dist < closestDist) {\r\n\t\t\t\t\t\t// we found a closer one, use it\r\n\t\t\t\t\t\tclosest = supply;\r\n\t\t\t\t\t\tclosestDist = dist;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (closest == null)\r\n\t\t\treturn false;\r\n\r\n\t\tthis.target = closest;\r\n\r\n\t\treturn closest != null;\r\n\t}\r\n\r\n\tpublic perform(labourer: Labourer): boolean {\r\n\t\tif (this.target.numOre >= 3) {\r\n\t\t\tthis.target.numOre -= 3;\r\n\t\t\tthis.hasOre = true;\r\n\t\t\t//TODO play effect, change actor icon\r\n\t\t\tlet backpack: BackPackComponent = labourer.backpack;\r\n\t\t\tbackpack.numOre += 3;\r\n\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\t// we got there but there was no ore available! Someone got there first. Cannot perform action\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\r\n}"]}
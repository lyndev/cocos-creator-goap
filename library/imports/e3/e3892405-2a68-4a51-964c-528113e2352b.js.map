{"version":3,"sources":["assets\\src\\app\\gamedata\\actions\\MineOreAction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,oDAA+C;AAC/C,2DAA0D;AAC1D,uDAAsD;AAGtD,8CAA6C;AAK7C;;;;;;GAMG;AACH;IAAmC,iCAAU;IAM5C;QAAA,YACC,iBAAO,SAIP;QAVO,WAAK,GAAY,KAAK,CAAC;QAEvB,eAAS,GAAW,CAAC,CAAC;QACtB,oBAAc,GAAW,CAAC,CAAC,CAAC,WAAW;QAI9C,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,4BAA4B;QAC9E,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,oCAAoC;QACtF,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;;IAC3C,CAAC;IAEM,6BAAK,GAAZ;QACC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;IACpB,CAAC;IAEM,8BAAM,GAAb;QACC,OAAO,IAAI,CAAC,KAAK,CAAC;IACnB,CAAC;IAEM,uCAAe,GAAtB;QACC,OAAO,IAAI,CAAC,CAAC,gCAAgC;IAC9C,CAAC;IAEM,mDAA2B,GAAlC,UAAmC,KAAkB;QACpD,8CAA8C;QAC9C,IAAI,KAAK,GAAwB,yBAAW,CAAC,SAAS,CAAC;QACvD,IAAI,OAAO,GAAsB,IAAI,CAAC;QACtC,IAAI,WAAW,GAAW,CAAC,CAAC;QAE5B,KAAiB,UAAK,EAAL,eAAK,EAAL,mBAAK,EAAL,IAAK,EAAE;YAAnB,IAAI,IAAI,cAAA;YACZ,IAAI,OAAO,IAAI,IAAI,EAAE;gBACpB,kCAAkC;gBAClC,OAAO,GAAG,IAAI,CAAC;gBACf,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;aACzC;iBAAM;gBACN,oCAAoC;gBACpC,IAAI,IAAI,GAAW,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;gBAC9C,IAAI,IAAI,GAAG,WAAW,EAAE;oBACvB,gCAAgC;oBAChC,OAAO,GAAG,IAAI,CAAC;oBACf,WAAW,GAAG,IAAI,CAAC;iBACnB;aACD;SACD;QACD,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;QAEtB,OAAO,OAAO,IAAI,IAAI,CAAC;IACxB,CAAC;IAEM,+BAAO,GAAd,UAAe,QAAkB;QAChC,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC;YACtB,IAAI,CAAC,SAAS,GAAG,kBAAQ,CAAC,OAAO,EAAE,CAAC;QAErC,IAAI,kBAAQ,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,EAAE;YAC9D,kBAAkB;YAClB,IAAI,QAAQ,GAAsB,QAAQ,CAAC,QAAQ,CAAC;YAAA,CAAC;YACrD,QAAQ,CAAC,MAAM,IAAI,CAAC,CAAC;YACrB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YAClB,IAAI,IAAI,GAAkB,QAAQ,CAAC,IAAI,CAAC;YACxC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACd,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE;gBACrB,iCAAiC;gBACjC,QAAQ,CAAC,WAAW,EAAE,CAAC;aACvB;SACD;QACD,OAAO,IAAI,CAAC;IACb,CAAC;IACF,oBAAC;AAAD,CAtEA,AAsEC,CAtEkC,uBAAU,GAsE5C;AAtEY,sCAAa","file":"","sourceRoot":"/","sourcesContent":["import TimeUtil from \"../../../utils/TimeUtil\";\r\nimport { ActionStatus } from \"../../ai/goap/ActionStatus\";\r\nimport { GoapAction } from \"../../ai/goap/GoapAction\";\r\nimport { VGameObject } from \"../../base/VGameObject\";\r\nimport { BackPackComponent } from \"../BackPackComponent\";\r\nimport { Environment } from \"../Environment\";\r\nimport { IronRockComponent } from \"../IronRockComponent\";\r\nimport { Labourer } from \"../labourers/Labourer\";\r\nimport { ToolComponent } from \"../ToolComponent\";\r\n\r\n/*\r\n * @Description: \r\n * @Author: RannarYang \r\n * @Date: 2018-09-06 00:13:23 \r\n * @Last Modified by: RannarYang\r\n * @Last Modified time: 2018-10-28 11:36:36\r\n */\r\nexport class MineOreAction extends GoapAction {\r\n\tprivate mined: boolean = false;\r\n\r\n\tprivate startTime: number = 0;\r\n\tprivate miningDuration: number = 2; // seconds;\r\n\r\n\tpublic constructor() {\r\n\t\tsuper();\r\n\t\tthis.addPrecondition(ActionStatus.HasTool, true); // we need a tool to do this\r\n\t\tthis.addPrecondition(ActionStatus.HasOre, false); // if we have ore we don't want more\r\n\t\tthis.addEffect(ActionStatus.HasOre, true);\r\n\t}\r\n\r\n\tpublic reset(): void {\r\n\t\tthis.mined = false;\r\n\t\tthis.startTime = 0;\r\n\t}\r\n\r\n\tpublic isDone(): boolean {\r\n\t\treturn this.mined;\r\n\t}\r\n\r\n\tpublic requiresInRange(): boolean {\r\n\t\treturn true; // yes we need to be near a rock\r\n\t}\r\n\r\n\tpublic checkProceduralPrecondition(agent: VGameObject): boolean {\r\n\t\t//TODO: find the nearest rock that we can mine\r\n\t\tlet rocks: IronRockComponent[] = Environment.rockComps;\r\n\t\tlet closest: IronRockComponent = null;\r\n\t\tlet closestDist: number = 0;\r\n\r\n\t\tfor (let rock of rocks) {\r\n\t\t\tif (closest == null) {\r\n\t\t\t\t// first one, so choose it for now\r\n\t\t\t\tclosest = rock;\r\n\t\t\t\tclosestDist = rock.distanceSquare(agent);\r\n\t\t\t} else {\r\n\t\t\t\t// is this one closer than the last?\r\n\t\t\t\tlet dist: number = rock.distanceSquare(agent);\r\n\t\t\t\tif (dist < closestDist) {\r\n\t\t\t\t\t// we found a closer one, use it\r\n\t\t\t\t\tclosest = rock;\r\n\t\t\t\t\tclosestDist = dist;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.target = closest;\r\n\r\n\t\treturn closest != null;\r\n\t}\r\n\r\n\tpublic perform(labourer: Labourer): boolean {\r\n\t\tif (this.startTime == 0)\r\n\t\t\tthis.startTime = TimeUtil.getTime();\r\n\r\n\t\tif (TimeUtil.getTime() - this.startTime > this.miningDuration) {\r\n\t\t\t// finished mining\r\n\t\t\tlet backpack: BackPackComponent = labourer.backpack;;\r\n\t\t\tbackpack.numOre += 2;\r\n\t\t\tthis.mined = true;\r\n\t\t\tlet tool: ToolComponent = labourer.tool;\r\n\t\t\ttool.use(0.5);\r\n\t\t\tif (tool.destroyed()) {\r\n\t\t\t\t//TODO:删除 Destroy(backpack.tool);\r\n\t\t\t\tlabourer.destroyTool();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}"]}
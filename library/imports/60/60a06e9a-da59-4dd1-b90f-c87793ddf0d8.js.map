{"version":3,"sources":["assets\\src\\app\\ai\\fsm\\StateManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["/*\r\n * @Description: 状态管理类\r\n * @Author: Rannar.Yang \r\n * @Date: 2018-06-29 10:16:55 \r\n * @Last Modified by: Rannar.Yang\r\n * @Last Modified time: 2018-07-05 17:35:31\r\n */\r\n\r\nimport { GoapAgent } from \"../goap/GoapAgent\";\r\nimport { StateBase } from \"./state/StateBase\";\r\n\r\nexport class StateManager {\r\n\tpublic static InvalidState: string = \"Invalid\";\r\n\r\n\tprotected _stateDic: { [key: string]: StateBase };\r\n\tprotected _currentState: StateBase = null;\r\n\tprotected _lastState: StateBase = null;\r\n\tprotected _owner: GoapAgent;\r\n\r\n\tconstructor(owner: any) {\r\n\t\tthis._stateDic = {};\r\n\t\tthis._owner = owner;\r\n\t}\r\n\r\n\r\n\tpublic isExist(stateKey: string): boolean {\r\n\t\treturn !!this._stateDic[stateKey];\r\n\t}\r\n\r\n\tpublic getStateByKey(stateKey: string): StateBase {\r\n\t\treturn this._stateDic[stateKey];\r\n\t}\r\n\r\n\t/**\r\n\t * 注册状态 \r\n\t * @param key\r\n\t * @param state\r\n\t * \r\n\t */\r\n\tpublic registerState(key: string, state: StateBase): void {\r\n\t\tif (this._owner != state.owner) {\r\n\t\t\tconsole.warn(\"statemachine 与 state 所有者不一致\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._stateDic[key] = state;\r\n\t}\r\n\r\n\t/**\r\n\t * 移除状态 \r\n\t * @param key\r\n\t * \r\n\t */\r\n\tpublic removeState(key: string): void {\r\n\t\tdelete this._stateDic[key];\r\n\t}\r\n\r\n\t/**\r\n\t * 改变状态 \r\n\t * @param key\r\n\t * @param obj\r\n\t * @param isForce 当当前状态和要切换的状态相同时，是否强制切换状态\r\n\t */\r\n\tpublic changeState(key: string, obj: any = null, isForce = false): void {\r\n\t\tif (!isForce && this._currentState && this._currentState.getStateKey() == key) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar newState: StateBase = this._stateDic[key];\r\n\t\tif (newState == null) {\r\n\t\t\tconsole.warn(\"unregister state type: \" + key);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._currentState != null) {\r\n\t\t\tthis._currentState.onExit(newState.getStateKey());\r\n\t\t}\r\n\r\n\t\tthis._lastState = this._currentState;\r\n\t\tthis._currentState = newState;\r\n\t\tthis._currentState.onEnter(obj);\r\n\t}\r\n\r\n\tpublic reEnterState(obj: any = null): void {\r\n\t\tif (this._currentState)\r\n\t\t\tthis._currentState.onReEnter(obj);\r\n\t}\r\n\r\n\t/**\r\n\t * 更新 \r\n\t * \r\n\t */\r\n\tpublic update(timeStamp): void {\r\n\t\tif (this._currentState != null)\r\n\t\t\tthis._currentState.onUpdate(timeStamp);\r\n\t}\r\n\r\n\t/**\r\n\t * 当前状态  \r\n\t * @return \r\n\t */\r\n\tpublic getCurrentState(): StateBase {\r\n\t\treturn this._currentState;\r\n\t}\r\n\t/**\r\n\t * 当前状态类型  \r\n\t * @return \r\n\t */\r\n\tpublic getCurrentStateKey(): string {\r\n\t\tif (this._currentState != null) {\r\n\t\t\treturn this._currentState.getStateKey();\r\n\t\t}\r\n\t\treturn StateManager.InvalidState;\r\n\t}\r\n\r\n\t/**当前在的状态 */\r\n\tpublic isInState(stateKey: string) {\r\n\t\treturn stateKey == this.getCurrentStateKey();\r\n\t}\r\n\t/**\r\n\t * 清除 \r\n\t */\r\n\tpublic clear(): void {\r\n\t\tif (this._currentState != null)\r\n\t\t\tthis._currentState.onExit(StateManager.InvalidState);\r\n\t\tthis._stateDic = {};\r\n\t\tthis._currentState = null;\r\n\t\tthis._lastState = null;\r\n\t}\r\n\t/**清除最后的状态 */\r\n\tpublic dispose() {\r\n\t\tif (this._currentState != null)\r\n\t\t\tthis._currentState.onExit(StateManager.InvalidState);\r\n\t\tthis._currentState = null;\r\n\t\tthis._lastState = null;\r\n\t}\r\n\r\n}\r\n"]}
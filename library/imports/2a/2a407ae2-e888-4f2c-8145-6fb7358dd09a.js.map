{"version":3,"sources":["assets/src/app/gamedata/actions/DropOffFirewoodAction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,2DAAyD;AACzD,uDAAqD;AACrD,sDAAoD;AACpD,8CAA4C;AAC5C,kDAAgD;AAGhD;IAA2C,yCAAU;IAGjD;QAAA,YACI,iBAAO,SAIV;QAPO,wBAAkB,GAAY,KAAK,CAAA;QAIvC,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,WAAW,EAAE,IAAI,CAAC,CAAA,CAAC,wDAAwD;QAC7G,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,WAAW,EAAE,KAAK,CAAC,CAAA,CAAC,0BAA0B;QAC1E,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,eAAe,EAAE,IAAI,CAAC,CAAA,CAAC,wBAAwB;;IAC/E,CAAC;IAEM,qCAAK,GAAZ;QACI,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAA;IACnC,CAAC;IAEM,sCAAM,GAAb;QACI,OAAO,IAAI,CAAC,kBAAkB,CAAA;IAClC,CAAC;IAEM,+CAAe,GAAtB;QACI,OAAO,IAAI,CAAA,CAAC,uEAAuE;IACvF,CAAC;IACM,2DAA2B,GAAlC,UAAmC,EAAW;QAC1C,4DAA4D;QAC5D,IAAI,WAAW,GAA0B,yBAAW,CAAC,eAAe,CAAA;QACpE,IAAI,OAAO,GAAwB,IAAI,CAAA;QACvC,IAAI,WAAW,GAAW,CAAC,CAAA;QAC3B,IAAI,WAAW,GAAG,EAAE,CAAC,YAAY,CAAC,yBAAW,CAAC,CAAA;QAC9C,KAAmB,UAAW,EAAX,2BAAW,EAAX,yBAAW,EAAX,IAAW,EAAE;YAA3B,IAAI,MAAM,oBAAA;YACX,IAAI,OAAO,IAAI,IAAI,EAAE;gBACjB,kCAAkC;gBAClC,OAAO,GAAG,MAAM,CAAA;gBAChB,WAAW,GAAG,MAAM,CAAC,cAAc,CAAC,WAAW,CAAC,CAAA;aACnD;iBAAM;gBACH,oCAAoC;gBACpC,IAAI,IAAI,GAAW,MAAM,CAAC,cAAc,CAAC,WAAW,CAAC,CAAA;gBACrD,IAAI,IAAI,GAAG,WAAW,EAAE;oBACpB,gCAAgC;oBAChC,OAAO,GAAG,MAAM,CAAA;oBAChB,WAAW,GAAG,IAAI,CAAA;iBACrB;aACJ;SACJ;QACD,IAAI,OAAO,IAAI,IAAI;YAAE,OAAO,KAAK,CAAA;QAEjC,IAAI,CAAC,MAAM,GAAG,OAAO,CAAA;QAErB,OAAO,OAAO,IAAI,IAAI,CAAA;IAC1B,CAAC;IAEM,uCAAO,GAAd,UAAe,IAAa;QACxB,IAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,mBAAQ,CAAC,CAAA;QAC1C,IAAI,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAA;QAChC,IAAI,CAAC,MAAM,CAAC,WAAW,IAAI,QAAQ,CAAC,WAAW,CAAA;QACrD,QAAQ,CAAC,WAAW,GAAG,CAAC,CAAA;QAClB,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAA;QAC9B,OAAO,IAAI,CAAA;IACf,CAAC;IACL,4BAAC;AAAD,CAzDA,AAyDC,CAzD0C,uBAAU,GAyDpD;AAzDY,sDAAqB","file":"","sourceRoot":"/","sourcesContent":["import { ActionStatus } from \"../../ai/goap/ActionStatus\"\nimport { GoapAction } from \"../../ai/goap/GoapAction\"\nimport { VGameObject } from \"../../base/VGameObject\"\nimport { Environment } from \"../Environment\"\nimport { Labourer } from \"../labourers/Labourer\"\nimport { SupplyPileComponent } from \"../SupplyPileComponent\"\n\nexport class DropOffFirewoodAction extends GoapAction {\n    private droppedOffFirewood: boolean = false\n    public target: SupplyPileComponent // where we drop off the ore\n    public constructor() {\n        super()\n        this.addPrecondition(ActionStatus.HasFirewood, true) // can't drop off firewood if we don't already have some\n        this.addEffect(ActionStatus.HasFirewood, false) // we now have no firewood\n        this.addEffect(ActionStatus.CollectFirewood, true) // we collected firewood\n    }\n\n    public reset(): void {\n        this.droppedOffFirewood = false\n    }\n\n    public isDone() {\n        return this.droppedOffFirewood\n    }\n\n    public requiresInRange() {\n        return true // yes we need to be near a supply pile so we can drop off the firewood\n    }\n    public checkProceduralPrecondition(go: cc.Node): boolean {\n        // TODO:find the nearest supply pile that has spare firewood\n        let supplyPiles: SupplyPileComponent[] = Environment.supplyPileComps\n        let closest: SupplyPileComponent = null\n        let closestDist: number = 0\n        let vGameObject = go.getComponent(VGameObject)\n        for (let supply of supplyPiles) {\n            if (closest == null) {\n                // first one, so choose it for now\n                closest = supply\n                closestDist = supply.distanceSquare(vGameObject)\n            } else {\n                // is this one closer than the last?\n                let dist: number = supply.distanceSquare(vGameObject)\n                if (dist < closestDist) {\n                    // we found a closer one, use it\n                    closest = supply\n                    closestDist = dist\n                }\n            }\n        }\n        if (closest == null) return false\n\n        this.target = closest\n\n        return closest != null\n    }\n\n    public perform(node: cc.Node): boolean {\n        let labourer = node.getComponent(Labourer)\n        let backpack = labourer.backpack\n        this.target.numFirewood += backpack.numFirewood\n\t\tbackpack.numFirewood = 0\n        this.droppedOffFirewood = true\n        return true\n    }\n}\n"]}
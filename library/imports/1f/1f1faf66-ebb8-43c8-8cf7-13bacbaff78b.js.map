{"version":3,"sources":["assets\\src\\app\\ai\\goap\\GoapAgent.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { StateEnum } from \"../fsm/state/StateEnum\";\r\nimport { StateIdle } from \"../fsm/state/StateIdle\";\r\nimport { StateMove } from \"../fsm/state/StateMove\";\r\nimport { StatePerformAction } from \"../fsm/state/StatePerformAction\";\r\nimport { StateManager } from \"../fsm/StateManager\";\r\nimport { ActionStatus } from \"./ActionStatus\";\r\nimport { GoapAction } from \"./GoapAction\";\r\nimport { GoapPlanner } from \"./GoapPlanner\";\r\nimport { IGoap } from \"./IGoap\";\r\n\r\n/*\r\n * @Description: \r\n * @Author: RannarYang \r\n * @Date: 2018-09-06 00:09:30 \r\n * @Last Modified by: RannarYang\r\n * @Last Modified time: 2018-11-04 17:41:31\r\n */\r\nexport class GoapAgent {\r\n\r\n\tprivate stateMgr: StateManager;\r\n\r\n\tprivate owner: IGoap;\r\n\tpublic getOwner(): IGoap {\r\n\t\treturn this.owner;\r\n\t}\r\n\tprivate planner: GoapPlanner;\r\n\tpublic getPlanner(): GoapPlanner {\r\n\t\treturn this.planner;\r\n\t}\r\n\r\n\tprivate availableActions: GoapAction[];\r\n\tpublic getAvaliableActions(): GoapAction[] {\r\n\t\treturn this.availableActions;\r\n\t}\r\n\r\n\tprivate currentActions: GoapAction[];\r\n\tpublic setCurrentActions(currentActions: GoapAction[]) {\r\n\t\tthis.currentActions = currentActions;\r\n\t}\r\n\tpublic peekCurrentActions(): GoapAction {\r\n\t\treturn this.currentActions[0];\r\n\t}\r\n\tpublic dequeueCurrentActions(): GoapAction {\r\n\t\treturn this.currentActions.shift();\r\n\t}\r\n\r\n\tpublic getCurrentActions(): GoapAction[] {\r\n\t\treturn this.currentActions;\r\n\t}\r\n\r\n\tpublic constructor(owner: IGoap) {\r\n\t\tthis.owner = owner;\r\n\t\tthis.initState();\r\n\t\tthis.planner = new GoapPlanner();\r\n\t\tthis.availableActions = [];\r\n\t\tthis.currentActions = [];\r\n\t\tthis.stateMgr.changeState(StateEnum.StateIdle);\r\n\t\tthis.loadActions();\r\n\t}\r\n\tprivate initState() {\r\n\t\tlet stateMgr = this.stateMgr = new StateManager(this);\r\n\t\tstateMgr.registerState(StateEnum.StateIdle, new StateIdle(this))\r\n\t\tstateMgr.registerState(StateEnum.StateMove, new StateMove(this))\r\n\t\tstateMgr.registerState(StateEnum.StatePerformAction, new StatePerformAction(this))\r\n\t}\r\n\r\n\tpublic changeState(key: string, obj?: any, isForce?: boolean) {\r\n\t\tthis.stateMgr.changeState(key, obj, isForce);\r\n\t}\r\n\r\n\tpublic update(delta: number) {\r\n\t\tthis.stateMgr.update(delta);\r\n\t}\r\n\tpublic addAction(a: GoapAction) {\r\n\t\tthis.availableActions.push(a);\r\n\t}\r\n\tpublic getAction<T extends GoapAction>(cls: { new(): T }) {\r\n\t\tfor (let action of this.availableActions) {\r\n\t\t\tif (action instanceof cls) {\r\n\t\t\t\treturn action;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tpublic removeAction(action: GoapAction) {\r\n\t\tfor (let i = 0, len = this.availableActions.length; i < len; i++) {\r\n\t\t\tif (this.availableActions[i] == action) {\r\n\t\t\t\tthis.availableActions.splice(i, 1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tpublic hasActionPlan() {\r\n\t\treturn this.currentActions.length > 0;\r\n\t}\r\n\r\n\tprivate loadActions() {\r\n\t\tlet actions: GoapAction[] = this.owner.getAvaliableActions();\r\n\t\tfor (let action of actions) {\r\n\t\t\tthis.availableActions.push(action);\r\n\t\t}\r\n\t\tconsole.log(\"Found actions: \" + GoapAgent.prettyPrintActions(actions));\r\n\r\n\t}\r\n\t// 输出 ==================================================\r\n\tpublic static prettyPrintState(state: Map<ActionStatus, Object>) {\r\n\t\tlet s: string = \"\";\r\n\t\tstate.forEach((value, key) => {\r\n\t\t\ts += key + \":\" + value;\r\n\t\t\ts += \", \";\r\n\t\t})\r\n\t\treturn s;\r\n\t}\r\n\r\n\tpublic static prettyPrintActionsQueue(actions: GoapAction[]): string {\r\n\t\tconsole.log(\"prettyPrintActionsQueue: \", actions)\r\n\t\tlet s: string = \"\";\r\n\t\tactions.forEach((action: GoapAction) => {\r\n\t\t\ts += action.constructor.name;\r\n\t\t\ts += \"-> \";\r\n\t\t})\r\n\t\ts += \"GOAL\";\r\n\t\treturn s;\r\n\t}\r\n\r\n\tpublic static prettyPrintActions(actions: GoapAction[]) {\r\n\t\tlet s: string = \"\";\r\n\t\tactions.forEach((action: GoapAction) => {\r\n\t\t\ts += action.constructor.name;\r\n\t\t\ts += \", \";\r\n\t\t})\r\n\t\treturn s;\r\n\t}\r\n\r\n\tpublic static prettyPrintAction(action: GoapAction) {\r\n\t\treturn \"\" + action.constructor.name;\r\n\t}\r\n\r\n}"]}
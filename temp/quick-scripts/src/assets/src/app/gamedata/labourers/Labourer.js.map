{"version":3,"sources":["assets/src/app/gamedata/labourers/Labourer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ActionStatus } from \"../../ai/goap/ActionStatus\"\nimport { GoapAction } from \"../../ai/goap/GoapAction\"\nimport { GoapAgent } from \"../../ai/goap/GoapAgent\"\nimport { IGoap } from \"../../ai/goap/IGoap\"\nimport { GameDataManager } from \"../../data/GameDataManager\"\nimport { LabourerType } from \"../../data/LabourerType\"\nimport { T_LabourerBean } from \"../../data/T_LabourerContainer\"\nimport { BackPackComponent } from \"../BackPackComponent\"\nimport { ToolComponent } from \"../ToolComponent\"\n\nconst { requireComponent, ccclass, property } = cc._decorator\n@ccclass\nexport class Labourer extends GoapAgent implements IGoap {\n    @property({ type: cc.Enum(LabourerType), displayName: \"type\" })\n    public labourerType: LabourerType = LabourerType.None\n\n    /**背包 */\n    public backpack: BackPackComponent\n    public bean: T_LabourerBean\n    public tool: ToolComponent\n\n    bMoving = false\n    bMoveEnd = false\n    public onLoad() {\n        super.onLoad()\n        let goapAgent = this.getComponent(GoapAgent)\n        goapAgent.setGoap(this)\n        this.bean = GameDataManager.I.t_labourderContainer.getLabourerByType(this.labourerType)\n        if (!this.tool) {\n            this.pickUpTool()\n        }\n    }\n\n    protected initAvaliableActions(actionCls: any[]) {\n        let action\n        this.availableActions = []\n        for (let i = 0, len = actionCls.length; i < len; i++) {\n            action = new actionCls[i]()\n            this.availableActions.push(action)\n        }\n    }\n\n    public update(dt: number) {\n\t\tsuper.update(dt)\n\t}\n\n    public getWorldState(): Map<string, Object> {\n        let worldData: Map<string, Object> = new Map<string, Object>()\n        worldData.set(ActionStatus.HasOre, this.backpack.hasOre())\n        worldData.set(ActionStatus.HasLogs, this.backpack.hasLog())\n        worldData.set(ActionStatus.HasFirewood, this.backpack.hasFirewood())\n        worldData.set(ActionStatus.HasTool, this.hasTool())\n        return worldData\n    }\n\n    private hasTool() {\n        return this.tool != null\n    }\n\n    public createGoalState(): Map<string, Object> {\n        throw new Error(\"Method not implemented.\")\n    }\n\n    public planFailed(failedGoad: Map<string, Object>) {\n        // Not handling this here since we are making sure our goals will always succeed.\n        // But normally you want to make sure the world state has changed before running\n        // the same goal again, or else it will just fail.\n    }\n\n    public planFound(goal: Map<string, Object>, actions: GoapAction[]) {\n        // Yay we found a plan for our goal\n        console.log(\"Plan found: \", GoapAgent.prettyPrintActionsQueue(actions))\n    }\n\n    public actionsFinished(): void {\n        // Everything is done, we completed our actions for this gool. Hooray!\n        console.log(\"Actions completed\")\n    }\n\n    public planAborted(aborter: GoapAction) {\n        // An action bailed out of the plan. State has been reset to plan again.\n        // Take note of what happened and make sure if you run the same goal again\n        // that it can succeed.\n        console.log(\"Plan Aborted: \" + GoapAgent.prettyPrintAction(aborter))\n    }\n\n    public moveAgent(nextAction: GoapAction, delta: number) {\n        let target = nextAction.target\n        if (this.bMoveEnd) {\n            this.bMoveEnd = false\n            return true\n        }\n        if (!this.bMoving) {\n            this.bMoving = true\n            let actions = []\n            actions.push(cc.moveTo(2, new cc.Vec2(target.node.x, target.node.y)))\n            actions.push(\n                cc.callFunc(() => {\n                    this.bMoveEnd = true\n                    this.bMoving = false\n                    nextAction.setInRange(true)\n                })\n            )\n            this.node.stopAllActions()\n            this.node.runAction(cc.sequence(actions))\n        }\n\n        return this.bMoveEnd\n    }\n\n    /**设置背包里的物品 */\n    public setBackPack(backpack: BackPackComponent) {\n        this.backpack = backpack\n        backpack.setOwner(this)\n    }\n    /**拾取工具 */\n    public pickUpTool() {\n        this.tool = new ToolComponent()\n        console.log(\"拾取工具\", this.constructor.name)\n    }\n\n    /**销毁工具 */\n    public destroyTool() {\n        this.tool = undefined\n    }\n\n    public updateBackPack() {}\n}\n"]}
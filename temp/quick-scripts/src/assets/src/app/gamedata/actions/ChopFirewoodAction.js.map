{"version":3,"sources":["assets\\src\\app\\gamedata\\actions\\ChopFirewoodAction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,oDAA+C;AAC/C,2DAA0D;AAC1D,uDAAsD;AAKtD,8CAA6C;AAG7C;;;;;;GAMG;AACH;IAAwC,sCAAU;IAKjD;QAAA,YACC,iBAAO,SAIP;QATO,aAAO,GAAY,KAAK,CAAC;QAEzB,eAAS,GAAW,CAAC,CAAC;QACvB,kBAAY,GAAW,CAAC,CAAC;QAG/B,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,4BAA4B;QAC9E,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC,yCAAyC;QAChG,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;;IAChD,CAAC;IACM,kCAAK,GAAZ;QACC,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;IACpB,CAAC;IACM,mCAAM,GAAb;QACC,OAAO,IAAI,CAAC,OAAO,CAAC;IACrB,CAAC;IAEM,4CAAe,GAAtB;QACC,OAAO,IAAI,CAAC;IACb,CAAC;IAEM,wDAA2B,GAAlC,UAAmC,KAAkB;QACpD,IAAI,QAAQ,GAAa,KAAiB,CAAC;QAC3C,+DAA+D;QAC/D,IAAI,MAAM,GAA6B,yBAAW,CAAC,kBAAkB,CAAC;QACtE,IAAI,OAAO,GAA2B,IAAI,CAAC;QAC3C,IAAI,WAAW,GAAW,CAAC,CAAC;QAE5B,KAAkB,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAM,EAAE;YAArB,IAAI,KAAK,eAAA;YACb,IAAI,OAAO,IAAI,IAAI,EAAE;gBACpB,OAAO,GAAG,KAAK,CAAC;gBAChB,WAAW,GAAG,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;aAC1C;iBAAM;gBACN,oCAAoC;gBACpC,IAAI,IAAI,GAAW,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;gBAC/C,IAAI,IAAI,GAAG,WAAW,EAAE;oBACvB,gCAAgC;oBAChC,OAAO,GAAG,KAAK,CAAC;oBAChB,WAAW,GAAG,IAAI,CAAC;iBACnB;aACD;SACD;QAED,IAAI,OAAO,IAAI,IAAI;YAClB,OAAO,KAAK,CAAC;QAEd,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;QAEtB,OAAO,OAAO,IAAI,IAAI,CAAC;IACxB,CAAC;IAEM,oCAAO,GAAd,UAAe,KAAY;QAC1B,IAAI,QAAQ,GAAG,KAAiB,CAAC;QACjC,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC;YACtB,IAAI,CAAC,SAAS,GAAG,kBAAQ,CAAC,OAAO,EAAE,CAAC;QAErC,IAAI,kBAAQ,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,EAAE;YAC5D,oBAAoB;YACpB,IAAI,QAAQ,GAAsB,QAAQ,CAAC,QAAQ,CAAC;YACpD,QAAQ,CAAC,WAAW,IAAI,CAAC,CAAC;YAC1B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YACpB,IAAI,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;YACzB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACf,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE;gBACrB,kCAAkC;gBAClC,QAAQ,CAAC,WAAW,EAAE,CAAC;aACvB;SACD;QACD,OAAO,IAAI,CAAC;IACb,CAAC;IACF,yBAAC;AAAD,CAxEA,AAwEC,CAxEuC,uBAAU,GAwEjD;AAxEY,gDAAkB","file":"","sourceRoot":"/","sourcesContent":["import TimeUtil from \"../../../utils/TimeUtil\";\r\nimport { ActionStatus } from \"../../ai/goap/ActionStatus\";\r\nimport { GoapAction } from \"../../ai/goap/GoapAction\";\r\nimport { IGoap } from \"../../ai/goap/IGoap\";\r\nimport { VGameObject } from \"../../base/VGameObject\";\r\nimport { BackPackComponent } from \"../BackPackComponent\";\r\nimport { ChoppingBlockComponent } from \"../ChoppingBlockComponent\";\r\nimport { Environment } from \"../Environment\";\r\nimport { Labourer } from \"../labourers/Labourer\";\r\n\r\n/*\r\n * @Description: \r\n * @Author: RannarYang \r\n * @Date: 2018-09-06 00:09:09 \r\n * @Last Modified by: RannarYang\r\n * @Last Modified time: 2018-11-04 17:35:57\r\n */\r\nexport class ChopFirewoodAction extends GoapAction {\r\n\tprivate chopped: boolean = false;\r\n\r\n\tprivate startTime: number = 0;\r\n\tpublic workDuration: number = 2;\r\n\tpublic constructor() {\r\n\t\tsuper();\r\n\t\tthis.addPrecondition(ActionStatus.HasTool, true); // we need a tool to do this\r\n\t\tthis.addPrecondition(ActionStatus.HasFirewood, false); // if we have firewood we don't want more\r\n\t\tthis.addEffect(ActionStatus.HasFirewood, true);\r\n\t}\r\n\tpublic reset() {\r\n\t\tthis.chopped = false;\r\n\t\tthis.startTime = 0;\r\n\t}\r\n\tpublic isDone() {\r\n\t\treturn this.chopped;\r\n\t}\r\n\r\n\tpublic requiresInRange() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tpublic checkProceduralPrecondition(agent: VGameObject): boolean {\r\n\t\tlet labourer: Labourer = agent as Labourer;\r\n\t\t// find the nearest chopping block that we can chop our wood at\r\n\t\tlet blocks: ChoppingBlockComponent[] = Environment.choppingBlockComps;\r\n\t\tlet closest: ChoppingBlockComponent = null;\r\n\t\tlet closestDist: number = 0;\r\n\r\n\t\tfor (let block of blocks) {\r\n\t\t\tif (closest == null) {\r\n\t\t\t\tclosest = block;\r\n\t\t\t\tclosestDist = block.distanceSquare(agent);\r\n\t\t\t} else {\r\n\t\t\t\t// is this one closer than the last?\r\n\t\t\t\tlet dist: number = block.distanceSquare(agent);\r\n\t\t\t\tif (dist < closestDist) {\r\n\t\t\t\t\t// we found a closer one, use it\r\n\t\t\t\t\tclosest = block;\r\n\t\t\t\t\tclosestDist = dist;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (closest == null)\r\n\t\t\treturn false;\r\n\r\n\t\tthis.target = closest;\r\n\r\n\t\treturn closest != null;\r\n\t}\r\n\r\n\tpublic perform(iGoap: IGoap): boolean {\r\n\t\tlet labourer = iGoap as Labourer;\r\n\t\tif (this.startTime == 0)\r\n\t\t\tthis.startTime = TimeUtil.getTime();\r\n\r\n\t\tif (TimeUtil.getTime() - this.startTime > this.workDuration) {\r\n\t\t\t// finished chopping\r\n\t\t\tlet backpack: BackPackComponent = labourer.backpack;\r\n\t\t\tbackpack.numFirewood += 5;\r\n\t\t\tthis.chopped = true;\r\n\t\t\tlet tool = labourer.tool;\r\n\t\t\ttool.use(0.34);\r\n\t\t\tif (tool.destroyed()) {\r\n\t\t\t\t// TODO:删除 Destroy(backpack.tool);\r\n\t\t\t\tlabourer.destroyTool();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}"]}
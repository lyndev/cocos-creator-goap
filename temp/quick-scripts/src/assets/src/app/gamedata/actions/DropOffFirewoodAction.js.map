{"version":3,"sources":["assets/src/app/gamedata/actions/DropOffFirewoodAction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,2DAA0D;AAC1D,uDAAsD;AAGtD,8CAA6C;AAI7C;;;;;;GAMG;AACH;IAA2C,yCAAU;IAEpD;QAAA,YACC,iBAAO,SAIP;QANO,wBAAkB,GAAY,KAAK,CAAC;QAG3C,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC,wDAAwD;QAC9G,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC,0BAA0B;QAC3E,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC,CAAC,wBAAwB;;IAC7E,CAAC;IAEM,qCAAK,GAAZ;QACC,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAC;IACjC,CAAC;IAEM,sCAAM,GAAb;QACC,OAAO,IAAI,CAAC,kBAAkB,CAAC;IAChC,CAAC;IAEM,+CAAe,GAAtB;QACC,OAAO,IAAI,CAAC,CAAC,uEAAuE;IACrF,CAAC;IACM,2DAA2B,GAAlC,UAAmC,KAAkB;QACpD,4DAA4D;QAC5D,IAAI,WAAW,GAA0B,yBAAW,CAAC,eAAe,CAAC;QACrE,IAAI,OAAO,GAAwB,IAAI,CAAC;QACxC,IAAI,WAAW,GAAW,CAAC,CAAC;QAE5B,KAAmB,UAAW,EAAX,2BAAW,EAAX,yBAAW,EAAX,IAAW,EAAE;YAA3B,IAAI,MAAM,oBAAA;YACd,IAAI,OAAO,IAAI,IAAI,EAAE;gBACpB,kCAAkC;gBAClC,OAAO,GAAG,MAAM,CAAC;gBACjB,WAAW,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;aAC3C;iBAAM;gBACN,oCAAoC;gBACpC,IAAI,IAAI,GAAW,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;gBAChD,IAAI,IAAI,GAAG,WAAW,EAAE;oBACvB,gCAAgC;oBAChC,OAAO,GAAG,MAAM,CAAC;oBACjB,WAAW,GAAG,IAAI,CAAC;iBACnB;aACD;SACD;QACD,IAAI,OAAO,IAAI,IAAI;YAClB,OAAO,KAAK,CAAC;QAEd,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;QAEtB,OAAO,OAAO,IAAI,IAAI,CAAC;IACxB,CAAC;IAEM,uCAAO,GAAd,UAAe,KAAY;QAC1B,IAAI,QAAQ,GAAG,KAAiB,CAAC;QACjC,IAAI,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;QACjC,QAAQ,CAAC,WAAW,IAAI,QAAQ,CAAC,WAAW,CAAC;QAC7C,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;QAC/B,QAAQ,CAAC,WAAW,GAAG,CAAC,CAAC;QAEzB,OAAO,IAAI,CAAC;IACb,CAAC;IACF,4BAAC;AAAD,CA1DA,AA0DC,CA1D0C,uBAAU,GA0DpD;AA1DY,sDAAqB","file":"","sourceRoot":"/","sourcesContent":["import { ActionStatus } from \"../../ai/goap/ActionStatus\";\nimport { GoapAction } from \"../../ai/goap/GoapAction\";\nimport { IGoap } from \"../../ai/goap/IGoap\";\nimport { VGameObject } from \"../../base/VGameObject\";\nimport { Environment } from \"../Environment\";\nimport { Labourer } from \"../labourers/Labourer\";\nimport { SupplyPileComponent } from \"../SupplyPileComponent\";\n\n/*\n * @Description: \n * @Author: RannarYang \n * @Date: 2018-09-06 00:09:17 \n * @Last Modified by: RannarYang\n * @Last Modified time: 2018-10-28 11:32:49\n */\nexport class DropOffFirewoodAction extends GoapAction {\n\tprivate droppedOffFirewood: boolean = false;\n\tpublic constructor() {\n\t\tsuper();\n\t\tthis.addPrecondition(ActionStatus.HasFirewood, true); // can't drop off firewood if we don't already have some\n\t\tthis.addEffect(ActionStatus.HasFirewood, false); // we now have no firewood\n\t\tthis.addEffect(ActionStatus.CollectFirewood, true); // we collected firewood\n\t}\n\n\tpublic reset(): void {\n\t\tthis.droppedOffFirewood = false;\n\t}\n\n\tpublic isDone() {\n\t\treturn this.droppedOffFirewood;\n\t}\n\n\tpublic requiresInRange() {\n\t\treturn true; // yes we need to be near a supply pile so we can drop off the firewood\n\t}\n\tpublic checkProceduralPrecondition(agent: VGameObject): boolean {\n\t\t// TODO:find the nearest supply pile that has spare firewood\n\t\tlet supplyPiles: SupplyPileComponent[] = Environment.supplyPileComps;\n\t\tlet closest: SupplyPileComponent = null;\n\t\tlet closestDist: number = 0;\n\n\t\tfor (let supply of supplyPiles) {\n\t\t\tif (closest == null) {\n\t\t\t\t// first one, so choose it for now\n\t\t\t\tclosest = supply;\n\t\t\t\tclosestDist = supply.distanceSquare(agent);\n\t\t\t} else {\n\t\t\t\t// is this one closer than the last?\n\t\t\t\tlet dist: number = supply.distanceSquare(agent);\n\t\t\t\tif (dist < closestDist) {\n\t\t\t\t\t// we found a closer one, use it\n\t\t\t\t\tclosest = supply;\n\t\t\t\t\tclosestDist = dist;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (closest == null)\n\t\t\treturn false;\n\n\t\tthis.target = closest;\n\n\t\treturn closest != null;\n\t}\n\n\tpublic perform(iGoap: IGoap): boolean {\n\t\tlet labourer = iGoap as Labourer;\n\t\tlet backpack = labourer.backpack;\n\t\tbackpack.numFirewood += backpack.numFirewood;\n\t\tthis.droppedOffFirewood = true;\n\t\tbackpack.numFirewood = 0;\n\n\t\treturn true;\n\t}\n}"]}
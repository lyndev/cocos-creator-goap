{"version":3,"sources":["assets/src/app/gamedata/actions/PickUpLogsAction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,2DAA0D;AAC1D,uDAAsD;AAKtD;;;;;;GAMG;AACH;IAAsC,oCAAU;IAG/C;QAAA,YACC,iBAAO,SAGP;QANO,aAAO,GAAY,KAAK,CAAC;QAIhC,KAAI,CAAC,eAAe,CAAC,2BAAY,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,0CAA0C;QAC7F,KAAI,CAAC,SAAS,CAAC,2BAAY,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,qBAAqB;;IAClE,CAAC;IAEM,gCAAK,GAAZ;QACC,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;IACtB,CAAC;IAEM,iCAAM,GAAb;QACC,OAAO,IAAI,CAAC,OAAO,CAAC;IACrB,CAAC;IAEM,0CAAe,GAAtB;QACC,OAAO,IAAI,CAAC;IACb,CAAC;IAEM,sDAA2B,GAAlC,UAAmC,KAAkB;QACpD,wDAAwD;QACxD,IAAI,WAAW,GAA0B,EAAE,CAAC;QAC5C,IAAI,OAAO,GAAwB,IAAI,CAAC;QACxC,IAAI,WAAW,GAAW,CAAC,CAAC;QAE5B,KAAmB,UAAW,EAAX,2BAAW,EAAX,yBAAW,EAAX,IAAW,EAAE;YAA3B,IAAI,MAAM,oBAAA;YACd,IAAI,MAAM,CAAC,OAAO,GAAG,CAAC,EAAE;gBACvB,IAAI,OAAO,IAAI,IAAI,EAAE;oBACpB,kCAAkC;oBAClC,OAAO,GAAG,MAAM,CAAC;oBACjB,WAAW,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;iBAC3C;qBAAM;oBACN,oCAAoC;oBACpC,IAAI,IAAI,GAAW,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;oBAChD,IAAI,IAAI,GAAG,WAAW,EAAE;wBACvB,gCAAgC;wBAChC,OAAO,GAAG,MAAM,CAAC;wBACjB,WAAW,GAAG,IAAI,CAAC;qBACnB;iBACD;aACD;SACD;QACD,IAAI,OAAO,IAAI,IAAI;YAClB,OAAO,KAAK,CAAC;QAEd,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC;QAEtB,OAAO,OAAO,IAAI,IAAI,CAAC;IACxB,CAAC;IAEM,kCAAO,GAAd,UAAe,QAAkB;QAChC,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,CAAC,EAAE;YAC5B,IAAI,CAAC,MAAM,CAAC,OAAO,IAAI,CAAC,CAAC;YACzB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YACpB,qCAAqC;YACrC,IAAI,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;YACjC,QAAQ,CAAC,OAAO,GAAG,CAAC,CAAC;YAErB,OAAO,IAAI,CAAC;SACZ;aAAM;YACN,+FAA+F;YAC/F,OAAO,KAAK,CAAC;SACb;IACF,CAAC;IACF,uBAAC;AAAD,CAlEA,AAkEC,CAlEqC,uBAAU,GAkE/C;AAlEY,4CAAgB","file":"","sourceRoot":"/","sourcesContent":["import { ActionStatus } from \"../../ai/goap/ActionStatus\";\nimport { GoapAction } from \"../../ai/goap/GoapAction\";\nimport { VGameObject } from \"../../base/VGameObject\";\nimport { Labourer } from \"../labourers/Labourer\";\nimport { SupplyPileComponent } from \"../SupplyPileComponent\";\n\n/*\n * @Description: \n * @Author: RannarYang \n * @Date: 2018-09-06 00:14:10 \n * @Last Modified by: RannarYang\n * @Last Modified time: 2018-10-28 11:36:49\n */\nexport class PickUpLogsAction extends GoapAction {\n\tprivate hasLogs: boolean = false;\n\tpublic target: SupplyPileComponent;  // where we get the logs from\n\tpublic constructor() {\n\t\tsuper();\n\t\tthis.addPrecondition(ActionStatus.HasLogs, false); // don't get a logs if we already have one\n\t\tthis.addEffect(ActionStatus.HasLogs, true); // we now have a logs\n\t}\n\n\tpublic reset() {\n\t\tthis.hasLogs = false;\n\t}\n\n\tpublic isDone(): boolean {\n\t\treturn this.hasLogs;\n\t}\n\n\tpublic requiresInRange(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic checkProceduralPrecondition(agent: VGameObject): boolean {\n\t\t//TODO: find the nearest supply pile that has spare logs\n\t\tlet supplyPiles: SupplyPileComponent[] = [];\n\t\tlet closest: SupplyPileComponent = null;\n\t\tlet closestDist: number = 0;\n\n\t\tfor (let supply of supplyPiles) {\n\t\t\tif (supply.numLogs > 0) {\n\t\t\t\tif (closest == null) {\n\t\t\t\t\t// first one, so choose it for now\n\t\t\t\t\tclosest = supply;\n\t\t\t\t\tclosestDist = supply.distanceSquare(agent);\n\t\t\t\t} else {\n\t\t\t\t\t// is this one closer than the last?\n\t\t\t\t\tlet dist: number = supply.distanceSquare(agent);\n\t\t\t\t\tif (dist < closestDist) {\n\t\t\t\t\t\t// we found a closer one, use it\n\t\t\t\t\t\tclosest = supply;\n\t\t\t\t\t\tclosestDist = dist;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (closest == null)\n\t\t\treturn false;\n\n\t\tthis.target = closest;\n\n\t\treturn closest != null;\n\t}\n\n\tpublic perform(labourer: Labourer): boolean {\n\t\tif (this.target.numLogs > 0) {\n\t\t\tthis.target.numLogs -= 1;\n\t\t\tthis.hasLogs = true;\n\t\t\t//TODO play effect, change actor icon\n\t\t\tlet backpack = labourer.backpack;\n\t\t\tbackpack.numLogs = 1;\n\n\t\t\treturn true;\n\t\t} else {\n\t\t\t// we got there but there was no logs available! Someone got there first. Cannot perform action\n\t\t\treturn false;\n\t\t}\n\t}\n}"]}
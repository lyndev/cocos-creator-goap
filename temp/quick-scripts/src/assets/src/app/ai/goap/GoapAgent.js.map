{"version":3,"sources":["assets/src/app/ai/goap/GoapAgent.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { StateEnum } from \"../fsm/state/StateEnum\";\nimport { StateIdle } from \"../fsm/state/StateIdle\";\nimport { StateMove } from \"../fsm/state/StateMove\";\nimport { StatePerformAction } from \"../fsm/state/StatePerformAction\";\nimport { StateManager } from \"../fsm/StateManager\";\nimport { ActionStatus } from \"./ActionStatus\";\nimport { GoapAction } from \"./GoapAction\";\nimport { GoapPlanner } from \"./GoapPlanner\";\nimport { IGoap } from \"./IGoap\";\n\n/*\n * @Description: \n * @Author: RannarYang \n * @Date: 2018-09-06 00:09:30 \n * @Last Modified by: RannarYang\n * @Last Modified time: 2018-11-04 17:41:31\n */\nexport class GoapAgent {\n\n\tprivate stateMgr: StateManager;\n\n\tprivate owner: IGoap;\n\tpublic getOwner(): IGoap {\n\t\treturn this.owner;\n\t}\n\tprivate planner: GoapPlanner;\n\tpublic getPlanner(): GoapPlanner {\n\t\treturn this.planner;\n\t}\n\n\tprivate availableActions: GoapAction[];\n\tpublic getAvaliableActions(): GoapAction[] {\n\t\treturn this.availableActions;\n\t}\n\n\tprivate currentActions: GoapAction[];\n\tpublic setCurrentActions(currentActions: GoapAction[]) {\n\t\tthis.currentActions = currentActions;\n\t}\n\tpublic peekCurrentActions(): GoapAction {\n\t\treturn this.currentActions[0];\n\t}\n\tpublic dequeueCurrentActions(): GoapAction {\n\t\treturn this.currentActions.shift();\n\t}\n\n\tpublic getCurrentActions(): GoapAction[] {\n\t\treturn this.currentActions;\n\t}\n\n\tpublic constructor(owner: IGoap) {\n\t\tthis.owner = owner;\n\t\tthis.initState();\n\t\tthis.planner = new GoapPlanner();\n\t\tthis.availableActions = [];\n\t\tthis.currentActions = [];\n\t\tthis.stateMgr.changeState(StateEnum.StateIdle);\n\t\tthis.loadActions();\n\t}\n\tprivate initState() {\n\t\tlet stateMgr = this.stateMgr = new StateManager(this);\n\t\tstateMgr.registerState(StateEnum.StateIdle, new StateIdle(this))\n\t\tstateMgr.registerState(StateEnum.StateMove, new StateMove(this))\n\t\tstateMgr.registerState(StateEnum.StatePerformAction, new StatePerformAction(this))\n\t}\n\n\tpublic changeState(key: string, obj?: any, isForce?: boolean) {\n\t\tthis.stateMgr.changeState(key, obj, isForce);\n\t}\n\n\tpublic update(delta: number) {\n\t\tthis.stateMgr.update(delta);\n\t}\n\tpublic addAction(a: GoapAction) {\n\t\tthis.availableActions.push(a);\n\t}\n\tpublic getAction<T extends GoapAction>(cls: { new(): T }) {\n\t\tfor (let action of this.availableActions) {\n\t\t\tif (action instanceof cls) {\n\t\t\t\treturn action;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tpublic removeAction(action: GoapAction) {\n\t\tfor (let i = 0, len = this.availableActions.length; i < len; i++) {\n\t\t\tif (this.availableActions[i] == action) {\n\t\t\t\tthis.availableActions.splice(i, 1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\tpublic hasActionPlan() {\n\t\treturn this.currentActions.length > 0;\n\t}\n\n\tprivate loadActions() {\n\t\tlet actions: GoapAction[] = this.owner.getAvaliableActions();\n\t\tfor (let action of actions) {\n\t\t\tthis.availableActions.push(action);\n\t\t}\n\t\tconsole.log(\"Found actions: \" + GoapAgent.prettyPrintActions(actions));\n\n\t}\n\t// 输出 ==================================================\n\tpublic static prettyPrintState(state: Map<ActionStatus, Object>) {\n\t\tlet s: string = \"\";\n\t\tstate.forEach((value, key) => {\n\t\t\ts += key + \":\" + value;\n\t\t\ts += \", \";\n\t\t})\n\t\treturn s;\n\t}\n\n\tpublic static prettyPrintActionsQueue(actions: GoapAction[]): string {\n\t\tconsole.log(\"prettyPrintActionsQueue: \", actions)\n\t\tlet s: string = \"\";\n\t\tactions.forEach((action: GoapAction) => {\n\t\t\ts += action.constructor.name;\n\t\t\ts += \"-> \";\n\t\t})\n\t\ts += \"GOAL\";\n\t\treturn s;\n\t}\n\n\tpublic static prettyPrintActions(actions: GoapAction[]) {\n\t\tlet s: string = \"\";\n\t\tactions.forEach((action: GoapAction) => {\n\t\t\ts += action.constructor.name;\n\t\t\ts += \", \";\n\t\t})\n\t\treturn s;\n\t}\n\n\tpublic static prettyPrintAction(action: GoapAction) {\n\t\treturn \"\" + action.constructor.name;\n\t}\n\n}"]}
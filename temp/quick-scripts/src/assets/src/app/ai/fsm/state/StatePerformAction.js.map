{"version":3,"sources":["assets\\src\\app\\ai\\fsm\\state\\StatePerformAction.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAGA,yCAAwC;AACxC,yCAAwC;AAExC;IAAwC,sCAAS;IAAjD;;IAkDA,CAAC;IA/CG;;;OAGG;IACI,qCAAQ,GAAf,UAAgB,SAAiB;QAC7B,qBAAqB;QACrB,IAAI,KAAK,GAAU,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;QAEzC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,EAAE,EAAE;YAC7B,wBAAwB;YACxB,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;YAC5B,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,qBAAS,CAAC,SAAS,CAAC,CAAC;YAC5C,KAAK,CAAC,eAAe,EAAE,CAAC;YACxB,OAAO;SACV;QACD,IAAI,MAAM,GAAe,IAAI,CAAC,KAAK,CAAC,kBAAkB,EAAE,CAAC;QACzD,IAAI,MAAM,CAAC,MAAM,EAAE,EAAE;YACjB,+DAA+D;YAC/D,IAAI,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC;SACtC;QAGD,IAAI,IAAI,CAAC,KAAK,CAAC,aAAa,EAAE,EAAE;YAC5B,0BAA0B;YAC1B,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,kBAAkB,EAAE,CAAC;YACzC,IAAI,OAAO,GAAY,MAAM,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;YAE5E,IAAI,OAAO,EAAE;gBACT,yCAAyC;gBACzC,IAAI,OAAO,GAAY,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBAE7C,IAAI,CAAC,OAAO,EAAE;oBACV,uCAAuC;oBACvC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,qBAAS,CAAC,SAAS,CAAC,CAAC;oBAC5C,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;iBAC7B;aACJ;iBAAM;gBACH,8BAA8B;gBAC9B,yBAAyB;gBACzB,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,qBAAS,CAAC,SAAS,CAAC,CAAC;aAC/C;SACJ;aAAM;YACH,sCAAsC;YACtC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,qBAAS,CAAC,SAAS,CAAC,CAAC;YAC5C,KAAK,CAAC,eAAe,EAAE,CAAC;SAC3B;IACL,CAAC;IACL,yBAAC;AAAD,CAlDA,AAkDC,CAlDuC,qBAAS,GAkDhD;AAlDY,gDAAkB","file":"","sourceRoot":"/","sourcesContent":["import { GoapAction } from \"../../goap/GoapAction\";\r\nimport { GoapAgent } from \"../../goap/GoapAgent\";\r\nimport { IGoap } from \"../../goap/IGoap\";\r\nimport { StateBase } from \"./StateBase\";\r\nimport { StateEnum } from \"./StateEnum\";\r\n\r\nexport class StatePerformAction extends StateBase {\r\n    protected _owner: GoapAgent\r\n\r\n    /**\r\n     * 状态更新 \r\n     * @return \r\n     */\r\n    public onUpdate(timeStamp: number): void {\r\n        // perform the action\r\n        let iGoap: IGoap = this.owner.getOwner();\r\n\r\n        if (!this.owner.hasActionPlan()) {\r\n            // no actions to perform\r\n            console.log(\"Done actions\");\r\n            this.owner.changeState(StateEnum.StateIdle);\r\n            iGoap.actionsFinished();\r\n            return;\r\n        }\r\n        let action: GoapAction = this.owner.peekCurrentActions();\r\n        if (action.isDone()) {\r\n            // the action is done. Remove it so we can perform the next one\r\n            this.owner.dequeueCurrentActions();\r\n        }\r\n\r\n\r\n        if (this.owner.hasActionPlan()) {\r\n            // perform the next action\r\n            action = this.owner.peekCurrentActions();\r\n            let inRange: boolean = action.requiresInRange() ? action.isInRange() : true;\r\n\r\n            if (inRange) {\r\n                // we are in range, so perform the action\r\n                let success: boolean = action.perform(iGoap);\r\n\r\n                if (!success) {\r\n                    // action failed, we need to plan again\r\n                    this.owner.changeState(StateEnum.StateIdle);\r\n                    iGoap.planAborted(action);\r\n                }\r\n            } else {\r\n                // we need to move there first\r\n                //TODO: push moveTo state\r\n                this.owner.changeState(StateEnum.StateMove);\r\n            }\r\n        } else {\r\n            // no actions left, move to Plan state\r\n            this.owner.changeState(StateEnum.StateIdle);\r\n            iGoap.actionsFinished();\r\n        }\r\n    }\r\n}"]}